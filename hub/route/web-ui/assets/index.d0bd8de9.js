import{R as e,c as v,f as et,r as m,a as we,E as Be,b as tt,d as X,e as be,u as Ee,g as Ce,h as T,i as Ne,j as Pe,k as W,l as Me,m as nt,n as he,o as st,p as Se,q as ot,s as se,t as at,v as lt,w as ct,x as rt,y as it,z as $e,A as ut,B as mt,C as dt,D as pt,F as ft,_ as K,G as Et,H as ht,I as yt,N as xt,J as gt,O as vt,K as wt,L as pe,M as bt,P as Ct,Q as Nt}from"./vendor.71a9bc4e.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(a){if(a.ep)return;a.ep=!0;const l=s(a);fetch(a.href,l)}})();function Q(){return navigator.userAgent==="ClashX Runtime"}let D=null;class Pt{constructor(t){this.instance=null,window.WebViewJavascriptBridge!=null&&(this.instance=window.WebViewJavascriptBridge),this.initBridge(s=>{this.instance=s,t()})}initBridge(t){if(!Q())return t==null?void 0:t(null);if(window.WebViewJavascriptBridge!=null)return t(window.WebViewJavascriptBridge);if(window.WVJBCallbacks!=null)return window.WVJBCallbacks.push(t);window.WVJBCallbacks=[t];const s=document.createElement("iframe");s.style.display="none",s.src="https://__bridge_loaded__",document.documentElement.appendChild(s),setTimeout(()=>document.documentElement.removeChild(s),0)}async callHandler(t,s){return await new Promise(o=>{var a;(a=this.instance)==null||a.callHandler(t,s,o)})}async ping(){return await this.callHandler("ping")}async readConfigString(){return await this.callHandler("readConfigString")}async getPasteboard(){return await this.callHandler("getPasteboard")}async getAPIInfo(){return await this.callHandler("apiInfo")}async setPasteboard(t){return await this.callHandler("setPasteboard",t)}async writeConfigWithString(t){return await this.callHandler("writeConfigWithString",t)}async setSystemProxy(t){return await this.callHandler("setSystemProxy",t)}async getStartAtLogin(){return await this.callHandler("getStartAtLogin")}async getProxyDelay(t){return await this.callHandler("speedTest",t)}async setStartAtLogin(t){return await this.callHandler("setStartAtLogin",t)}async isSystemProxySet(){return await this.callHandler("isSystemProxySet")}}function St(n){if(D!=null){n();return}D=new Pt(n)}function G(n){const{title:t,children:s,className:o,style:a}=n;return e.createElement("header",{className:v("header",o),style:a},e.createElement("h1",{className:"md:text-xl"},t),e.createElement("div",{className:"flex flex-auto items-center justify-end"},s))}function R(n){const{type:t,size:s=14,className:o,style:a}=n,l=v("clash-iconfont",`icon-${t}`,o),c={fontSize:s,...a},r={...n,className:l,style:c};return e.createElement("i",{...r})}function H(){}function kt(n,t){const s=[],o=[];for(const a of n)t(a)?s.push(a):o.push(a);return[s,o]}function z(n){var o;const t=["B","KiB","MiB","GiB","TiB"],s=Math.floor(Math.log(n||1)/Math.log(1024));return`${et(n/Math.pow(1024,s),2).toFixed(2)} ${(o=t==null?void 0:t[s])!=null?o:""}`}function ze(n){return n.replace(/.*[/\\]/,"")}function fe(n){const{className:t,checked:s=!1,disabled:o=!1,onChange:a=H}=n,l=v("switch",{checked:s,disabled:o},t);function c(){o||a(!s)}return e.createElement("div",{className:l,onClick:c},e.createElement(R,{className:"switch-icon font-bold",type:"check",size:20}))}const U=m.exports.forwardRef((n,t)=>{const{className:s,style:o,children:a}=n;return e.createElement("div",{className:v("card",s),style:o,ref:t},a)});function Ie(n){const{options:t,value:s,onSelect:o}=n;return e.createElement("div",{className:"button-select"},t.map(a=>e.createElement("button",{value:a.value,key:a.value,className:v("button-select-options",{actived:s===a.value}),onClick:()=>o==null?void 0:o(a.value)},a.label)))}const Dt={SideBar:{Proxies:"Proxies",Overview:"Overview",Logs:"Logs",Rules:"Rules",Settings:"Setting",Connections:"Connections",Version:"Version",Inbounds:"Inbounds"},Settings:{title:"Settings",labels:{startAtLogin:"Start at login",language:"language",setAsSystemProxy:"Set as system proxy",allowConnectFromLan:"Allow connect from Lan",proxyMode:"Mode",socks5ProxyPort:"Socks5 proxy port",httpProxyPort:"HTTP proxy port",mixedProxyPort:"Mixed proxy port",externalController:"External controller"},values:{cn:"\u4E2D\u6587",en:"English",global:"Global",rules:"Rules",direct:"Direct",script:"Script"},versionString:"Current ClashX is the latest version\uFF1A{{version}}",checkUpdate:"Check Update",externalControllerSetting:{title:"External Controller",note:"Please note that modifying this configuration will only configure Dashboard. Will not modify your Clash configuration file. Please make sure that the external controller address matches the address in the Clash configuration file, otherwise, Dashboard will not be able to connect to Clash.",host:"Host",port:"Port",secret:"Secret"}},Logs:{title:"Logs",levelLabel:"Log level"},Rules:{title:"Rules",providerTitle:"Providers",providerUpdateTime:"Last updated at",ruleCount:"Rule count"},Connections:{title:"Connections",keepClosed:"Keep closed connections",total:{text:"total",upload:"upload",download:"download"},closeAll:{title:"Warning",content:"This would close all connections"},filter:{all:"All"},columns:{host:"Host",network:"Network",type:"Type",chains:"Chains",process:"Process",rule:"Rule",time:"Time",speed:"Speed",upload:"Upload",download:"Download",sourceIP:"Source IP"},info:{title:"Connection",id:"ID",host:"Host",hostEmpty:"Empty",dstIP:"IP",dstIPEmpty:"Empty",srcIP:"Source",upload:"Up",download:"Down",network:"Network",process:"Process",processPath:"Path",inbound:"Inbound",rule:"Rule",chains:"Chains",status:"Status",opening:"Open",closed:"Closed",closeConnection:"Close"}},Proxies:{title:"Proxies",editDialog:{title:"Edit Proxy",color:"Color",name:"Name",type:"Type",server:"Server",port:"Port",password:"Password",cipher:"Cipher",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"Policy Group",providerTitle:"Providers",providerUpdateTime:"Last updated at",expandText:"Expand",collapseText:"Collapse",speedTestText:"Speed Test",breakConnectionsText:"Close connections which include the group"},Modal:{ok:"Ok",cancel:"Cancel"}},Ft={SideBar:{Proxies:"\u4EE3\u7406",Overview:"\u603B\u89C8",Logs:"\u65E5\u5FD7",Rules:"\u89C4\u5219",Settings:"\u8BBE\u7F6E",Connections:"\u8FDE\u63A5",Version:"\u7248\u672C",Inbounds:"\u5165\u7AD9"},Settings:{title:"\u8BBE\u7F6E",labels:{startAtLogin:"\u5F00\u673A\u65F6\u542F\u52A8",language:"\u8BED\u8A00",setAsSystemProxy:"\u8BBE\u7F6E\u4E3A\u7CFB\u7EDF\u4EE3\u7406",allowConnectFromLan:"\u5141\u8BB8\u6765\u81EA\u5C40\u57DF\u7F51\u7684\u8FDE\u63A5",proxyMode:"\u4EE3\u7406\u6A21\u5F0F",socks5ProxyPort:"Socks5 \u4EE3\u7406\u7AEF\u53E3",httpProxyPort:"HTTP \u4EE3\u7406\u7AEF\u53E3",mixedProxyPort:"\u6DF7\u5408\u4EE3\u7406\u7AEF\u53E3",externalController:"\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E"},values:{cn:"\u4E2D\u6587",en:"English",global:"\u5168\u5C40",rules:"\u89C4\u5219",direct:"\u76F4\u8FDE",script:"\u811A\u672C"},versionString:"\u5F53\u524D ClashX \u5DF2\u662F\u6700\u65B0\u7248\u672C\uFF1A{{version}}",checkUpdate:"\u68C0\u67E5\u66F4\u65B0",externalControllerSetting:{title:"\u7F16\u8F91\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E",note:"\u8BF7\u6CE8\u610F\uFF0C\u4FEE\u6539\u8BE5\u914D\u7F6E\u9879\u5E76\u4E0D\u4F1A\u4FEE\u6539\u4F60\u7684 Clash \u914D\u7F6E\u6587\u4EF6\uFF0C\u8BF7\u786E\u8BA4\u4FEE\u6539\u540E\u7684\u5916\u90E8\u63A7\u5236\u5730\u5740\u548C Clash \u914D\u7F6E\u6587\u4EF6\u5185\u7684\u5730\u5740\u4E00\u81F4\uFF0C\u5426\u5219\u4F1A\u5BFC\u81F4 Dashboard \u65E0\u6CD5\u8FDE\u63A5\u3002",host:"Host",port:"\u7AEF\u53E3",secret:"\u5BC6\u94A5"}},Logs:{title:"\u65E5\u5FD7",levelLabel:"\u65E5\u5FD7\u7B49\u7EA7"},Rules:{title:"\u89C4\u5219",providerTitle:"\u89C4\u5219\u96C6",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",ruleCount:"\u89C4\u5219\u6761\u6570"},Connections:{title:"\u8FDE\u63A5",keepClosed:"\u4FDD\u7559\u5173\u95ED\u8FDE\u63A5",total:{text:"\u603B\u91CF",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D"},closeAll:{title:"\u8B66\u544A",content:"\u5C06\u4F1A\u5173\u95ED\u6240\u6709\u8FDE\u63A5"},filter:{all:"\u5168\u90E8"},columns:{host:"\u57DF\u540D",network:"\u7F51\u7EDC",process:"\u8FDB\u7A0B",type:"\u7C7B\u578B",chains:"\u8282\u70B9\u94FE",rule:"\u89C4\u5219",time:"\u8FDE\u63A5\u65F6\u95F4",speed:"\u901F\u7387",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",sourceIP:"\u6765\u6E90 IP"},info:{title:"\u8FDE\u63A5\u4FE1\u606F",id:"ID",host:"\u57DF\u540D",hostEmpty:"\u7A7A",dstIP:"IP",dstIPEmpty:"\u7A7A",srcIP:"\u6765\u6E90",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",network:"\u7F51\u7EDC",process:"\u8FDB\u7A0B",processPath:"\u8DEF\u5F84",inbound:"\u5165\u53E3",rule:"\u89C4\u5219",chains:"\u4EE3\u7406",status:"\u72B6\u6001",opening:"\u8FDE\u63A5\u4E2D",closed:"\u5DF2\u5173\u95ED",closeConnection:"\u5173\u95ED\u8FDE\u63A5"}},Proxies:{title:"\u4EE3\u7406",editDialog:{title:"\u7F16\u8F91\u4EE3\u7406",color:"\u989C\u8272",name:"\u540D\u5B57",type:"\u7C7B\u578B",server:"\u670D\u52A1\u5668",port:"\u7AEF\u53E3",password:"\u5BC6\u7801",cipher:"\u52A0\u5BC6\u65B9\u5F0F",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"\u7B56\u7565\u7EC4",providerTitle:"\u4EE3\u7406\u96C6",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",expandText:"\u5C55\u5F00",collapseText:"\u6536\u8D77",speedTestText:"\u6D4B\u901F",breakConnectionsText:"\u5207\u6362\u65F6\u6253\u65AD\u5305\u542B\u7B56\u7565\u7EC4\u7684\u8FDE\u63A5"},Modal:{ok:"\u786E \u5B9A",cancel:"\u53D6 \u6D88"}},He={en_US:Dt,zh_CN:Ft},At=Object.keys(He);function Lt(){for(const n of window.navigator.languages){if(n.includes("zh"))return"zh_CN";if(n.includes("us"))return"en_US"}return"en_US"}function le(n){return m.exports.useMemo(()=>{function s(o,a){if(typeof o=="string")n(l=>{const c=o,r=a;l[c]=r});else if(typeof o=="function"){const l=o;n(c=>l(c))}else typeof o=="object"&&n(l=>we(l,c=>{const r=o;for(const u of Object.keys(r)){const p=u;c[p]=r[p]}}))}return s},[n])}class Ue{constructor(t){this.EE=new Be,this.innerBuffer=[],this.url="",this.connection=null,this.config=Object.assign({bufferLength:0,retryInterval:5e3},t)}connectWebsocket(){if(!this.url)return;const t=new URL(this.url);this.connection=new WebSocket(t.toString()),this.connection.addEventListener("message",s=>{const o=JSON.parse(s.data);this.EE.emit("data",[o]),this.config.bufferLength>0&&(this.innerBuffer.push(o),this.innerBuffer.length>this.config.bufferLength&&this.innerBuffer.splice(0,this.innerBuffer.length-this.config.bufferLength))}),this.connection.addEventListener("error",s=>{var o;this.EE.emit("error",s),(o=this.connection)==null||o.close(),setTimeout(this.connectWebsocket,this.config.retryInterval)})}connect(t){var s;this.url===t&&this.connection||(this.url=t,(s=this.connection)==null||s.close(),this.connectWebsocket())}subscribe(t,s){this.EE.addListener(t,s)}unsubscribe(t,s){this.EE.removeListener(t,s)}buffer(){return this.innerBuffer.slice()}destory(){var t;this.EE.removeAllListeners(),(t=this.connection)==null||t.close(),this.connection=null}}class $t{constructor(t,s){this.axiosClient=tt.create({baseURL:t,headers:s?{Authorization:`Bearer ${s}`}:{}})}async getConfig(){return await this.axiosClient.get("configs")}async updateConfig(t){return await this.axiosClient.patch("configs",t)}async getRules(){return await this.axiosClient.get("rules")}async getProxyProviders(){const t=await this.axiosClient.get("providers/proxies",{validateStatus(s){return s>=200&&s<300||s===404}});return t.status===404&&(t.data={providers:{}}),t}async getRuleProviders(){return await this.axiosClient.get("providers/rules")}async updateProvider(t){return await this.axiosClient.put(`providers/proxies/${encodeURIComponent(t)}`)}async updateRuleProvider(t){return await this.axiosClient.put(`providers/rules/${encodeURIComponent(t)}`)}async healthCheckProvider(t){return await this.axiosClient.get(`providers/proxies/${encodeURIComponent(t)}/healthcheck`)}async getProxies(){return await this.axiosClient.get("proxies")}async getProxy(t){return await this.axiosClient.get(`proxies/${encodeURIComponent(t)}`)}async getVersion(){return await this.axiosClient.get("version")}async getProxyDelay(t){return await this.axiosClient.get(`proxies/${encodeURIComponent(t)}/delay`,{params:{timeout:5e3,url:"http://www.gstatic.com/generate_204"}})}async closeAllConnections(){return await this.axiosClient.delete("connections")}async closeConnection(t){return await this.axiosClient.delete(`connections/${t}`)}async getConnections(){return await this.axiosClient.get("connections")}async changeProxySelected(t,s){return await this.axiosClient.put(`proxies/${encodeURIComponent(t)}`,{name:s})}async getInbounds(){return await this.axiosClient.get("inbounds")}}const It=X(async()=>{if(!Q())return null;const n=await D.getAPIInfo();return{hostname:n.host,port:n.port,secret:n.secret,protocol:"http:"}}),Oe=be("externalControllers",[]);function te(){var p,d,E,y,h,f,x,b,N,S,k,A,q,O,J;const n=Ee(It),t=Ce(),s=Ee(Oe);if(n!=null)return n;let o;{const j=document.querySelector('meta[name="external-controller"]');((p=j==null?void 0:j.content)==null?void 0:p.match(/^https?:/))!=null&&(o=new URL(j.content))}const a=new URLSearchParams(t.search),l=(h=(y=(d=o==null?void 0:o.hostname)!=null?d:a.get("host"))!=null?y:(E=s==null?void 0:s[0])==null?void 0:E.hostname)!=null?h:"127.0.0.1",c=(N=(b=(f=o==null?void 0:o.port)!=null?f:a.get("port"))!=null?b:(x=s==null?void 0:s[0])==null?void 0:x.port)!=null?N:"9090",r=(q=(A=(S=o==null?void 0:o.username)!=null?S:a.get("secret"))!=null?A:(k=s==null?void 0:s[0])==null?void 0:k.secret)!=null?q:"",u=((O=a.get("protocol"))!=null?O:l==="127.0.0.1")?"http:":(J=o==null?void 0:o.protocol)!=null?J:window.location.protocol;return{hostname:l,port:c,secret:r,protocol:u}}const Rt=X({key:"",instance:null});function $(){const{hostname:n,port:t,secret:s,protocol:o}=te(),[a,l]=T(Rt),c=`${o}//${n}:${t}?secret=${s}`;if(a.key===c)return a.instance;const r=new $t(`${o}//${n}:${t}`,s);return l({key:c,instance:r}),r}const ke=X(!0),Tt=be("language",void 0);function F(){const[n,t]=T(Tt),s=m.exports.useMemo(()=>n!=null?n:Lt(),[n]),o=m.exports.useCallback(function(a){function l(c){return st(He[s][a],c)}return{t:l}},[s]);return{lang:s,locales:At,setLang:t,translation:o}}const je=X({version:"",premium:!1});function Ve(){const[n,t]=T(je),s=$(),o=Pe(ke);return W([s],async function(){const a=await Me.fromPromise(s.getVersion(),l=>l);o(a.isOk()),t(a.isErr()?{version:"",premium:!1}:{version:a.value.data.version,premium:!!a.value.data.premium})}),n}function _e(){const[{premium:n}]=T(je),t=$(),{data:s,mutate:o}=W(["/providers/rule",t,n],async()=>{if(!n)return[];const a=await t.getRuleProviders();return Object.keys(a.data.providers).map(l=>a.data.providers[l])});return{providers:s!=null?s:[],update:o}}const Bt=be("profile",{breakConnections:!1,logLevel:""});function ce(){const[n,t]=T(Bt),s=m.exports.useCallback(o=>{t(we(n,o))},[n,t]);return{data:n,set:le(s)}}const We=X([]);function Ge(){const[n,t]=T(We),s=$(),{data:o,mutate:a}=W(["/providers/proxy",s],async()=>{const l=await s.getProxyProviders();return Object.keys(l.data.providers).map(c=>l.data.providers[c]).filter(c=>c.name!=="default").filter(c=>c.vehicleType!=="Compatible")});return m.exports.useEffect(()=>{t(o!=null?o:[])},[o,t]),{providers:n,update:a}}function re(){const n=$(),{data:t,mutate:s}=W(["/config",n],async()=>{var l;const a=(await n.getConfig()).data;return{port:a.port,socksPort:a["socks-port"],mixedPort:(l=a["mixed-port"])!=null?l:0,redirPort:a["redir-port"],mode:a.mode.toLowerCase(),logLevel:a["log-level"],allowLan:a["allow-lan"]}});return{general:t!=null?t:{},update:s}}const Je=Ne({proxies:[],groups:[],global:{name:"GLOBAL",type:"Selector",now:"",history:[],all:[]}});function ie(){const[n,t]=T(Je),s=le(t),o=$(),{mutate:a}=W(["/proxies",o],async()=>{const c=await o.getProxies(),r=c.data.proxies.GLOBAL;r.name="GLOBAL";const u=new Set(["Selector","URLTest","Fallback","LoadBalance"]),p=new Set(["DIRECT","REJECT","GLOBAL"]),d=r.all.filter(h=>!p.has(h)).map(h=>({...c.data.proxies[h],name:h})),[E,y]=kt(d,h=>!u.has(h.type));s({proxies:E,groups:y,global:r})}),l=m.exports.useCallback((c,r)=>{s(u=>{c==="GLOBAL"&&(u.global.now=r);for(const p of u.groups)p.name===c&&(p.now=r)})},[s]);return{proxies:n.proxies,groups:n.groups,global:n.global,update:a,markProxySelected:l,set:s}}const Mt=X(n=>{const t=n(Je),s=n(We),o=new Map;for(const a of t.proxies)o.set(a.name,a);for(const a of s)for(const l of a.proxies)o.set(l.name,l);return o});function Xe(){const{data:n,mutate:t}=W("/clashx",async()=>{var a,l;if(!Q())return{isClashX:!1,startAtLogin:!1,systemProxy:!1};const s=(a=await(D==null?void 0:D.getStartAtLogin()))!=null?a:!1,o=(l=await(D==null?void 0:D.isSystemProxySet()))!=null?l:!1;return{startAtLogin:s,systemProxy:o,isClashX:!0}});return{data:n,update:t}}const zt=Ne([]);function Ht(){const[n,t]=T(zt),s=le(t),o=$();async function a(){const l=await o.getRules();s(l.data.rules)}return{rules:n,update:a}}const Ut=X(new Ue({bufferLength:200}));function qe(){const n=te(),{general:t}=re(),{data:{logLevel:s}}=ce(),o=Ee(Ut),a=s||t.logLevel,l=nt(`${n.protocol}//${n.hostname}:${n.port}/logs?level=${a}&secret=${encodeURIComponent(n.secret)}`),c=he(n);return m.exports.useEffect(()=>{if(a){const r=c.current,p=`${r.protocol==="http:"?"ws:":"wss:"}//${r.hostname}:${r.port}/logs?level=${a}&token=${encodeURIComponent(r.secret)}`;o.connect(p)}},[c,o,a,l]),o}function Ot(){const n=te(),t=m.exports.useRef(new Ue({bufferLength:200})),o=`${n.protocol==="http:"?"ws:":"wss:"}//${n.hostname}:${n.port}/connections?token=${encodeURIComponent(n.secret)}`;return m.exports.useEffect(()=>{t.current.connect(o)},[o]),t.current}const jt=Ne([]);function Vt(){const[n,t]=T(jt),s=le(t),o=$();async function a(){const l=await o.getInbounds();s(l.data)}return{inbounds:n,update:a}}function _t(n){const{className:t,data:s,onClick:o,select:a,canClick:l,errSet:c,rowHeight:r}=n,{translation:u}=F(),{t:p}=u("Proxies"),[d,E]=m.exports.useState(!1),[y,h]=m.exports.useState(!1),f=m.exports.useRef(null);m.exports.useLayoutEffect(()=>{var k,A;h(((A=(k=f==null?void 0:f.current)==null?void 0:k.offsetHeight)!=null?A:0)>30)},[]);const x=d?"auto":r,b=l?o:H;function N(){E(!d)}const S=s.map(k=>{const A=v({"tags-selected":a===k,"cursor-pointer":l,error:c==null?void 0:c.has(k)});return e.createElement("li",{className:A,key:k,onClick:()=>b(k)},k)});return e.createElement("div",{className:v("flex items-start overflow-y-hidden",t),style:{height:x}},e.createElement("ul",{ref:f,className:v("tags",{expand:d})},S),y&&e.createElement("span",{className:"h-7 cursor-pointer select-none px-5 leading-7",onClick:N},p(d?"collapseText":"expandText")))}function Y(n){const{className:t,style:s,value:o="",align:a="center",inside:l=!1,autoFocus:c=!1,type:r="text",disabled:u=!1,onChange:p=H,onBlur:d=H,onEnter:E=H}=n,y=v("input",`text-${a}`,{"focus:shadow-none":l},t);function h(f){f.code==="Enter"&&E(f)}return e.createElement("input",{disabled:u,className:y,style:s,value:o,autoFocus:c,type:r,onChange:f=>p(f.target.value,f),onBlur:d,onKeyDown:h})}function Wt(n){const{value:t,options:s,onSelect:o,disabled:a,className:l,style:c}=n,r=m.exports.useRef(document.createElement("div")),u=m.exports.useRef(null),[p,d]=m.exports.useState(!1),[E,y]=m.exports.useState({});m.exports.useLayoutEffect(()=>{const b=u.current.getBoundingClientRect();y({top:Math.floor(b.top+b.height)+6,left:Math.floor(b.left)-10})},[]),m.exports.useLayoutEffect(()=>{const b=r.current;return document.body.appendChild(b),()=>{document.body.removeChild(b)}},[]);function h(){a||d(!p)}const f=m.exports.useMemo(()=>s.find(b=>b.value===t),[t,s]),x=e.createElement("div",{className:v("select-list",{"select-list-show":p}),style:E},e.createElement("ul",{className:"list"},s.map(b=>{var N;return e.createElement(Gt,{className:v({selected:b.value===t}),onClick:S=>{o==null||o(b.value,S),d(!1)},disabled:b.disabled,key:(N=b.key)!=null?N:b.value,value:b.value},b.label)})));return e.createElement(e.Fragment,null,e.createElement("div",{className:v("select",{disabled:a},l),style:c,ref:u,onClick:h},f==null?void 0:f.label,e.createElement(R,{type:"triangle-down"})),Se.exports.createPortal(x,r.current))}function Gt(n){const{className:t,style:s,disabled:o=!1,children:a,onClick:l=H}=n,c=v("option",{disabled:o},t);return e.createElement("li",{className:c,style:s,onClick:l},a)}function Ke(n){const{show:t=!0,title:s="Modal",size:o="small",footer:a=!0,onOk:l=H,onClose:c=H,bodyClassName:r,bodyStyle:u,className:p,style:d,children:E}=n,{translation:y}=F(),{t:h}=y("Modal"),f=m.exports.useRef(document.createElement("div")),x=m.exports.useRef(null);m.exports.useLayoutEffect(()=>{const S=f.current;return document.body.appendChild(S),()=>{document.body.removeChild(S)}},[]);function b(S){S.target===x.current&&c()}const N=e.createElement("div",{className:v("modal-mask",{"modal-show":t}),ref:x,onMouseDown:b},e.createElement("div",{className:v("modal",`modal-${o}`,p),style:d},e.createElement("div",{className:"modal-title"},s),e.createElement("div",{className:v("modal-body",r),style:u},E),a&&e.createElement("div",{className:"footer"},e.createElement(ye,{onClick:()=>c()},h("cancel")),e.createElement(ye,{type:"primary",onClick:()=>l()},h("ok")))));return Se.exports.createPortal(N,f.current)}const Jt={success:"check",info:"info",warning:"info",error:"close"};function Xt(n){const{message:t="",type:s="info",inside:o=!1,children:a,className:l,style:c}=n,r=v("alert",`alert-${o?"note":"box"}-${s}`,l);return e.createElement("div",{className:r,style:c},e.createElement("span",{className:"alert-icon"},e.createElement(R,{type:Jt[s],size:26})),t?e.createElement("p",{className:"alert-message"},t):e.createElement("div",{className:"alert-message"},a))}function ye(n){const{type:t="normal",onClick:s=H,children:o,className:a,style:l,disiabled:c}=n,r=v("button",`button-${t}`,a,{"button-disabled":c});return e.createElement("button",{className:r,style:l,onClick:s,disabled:c},o)}function oe(n){const[t,s]=ot(n),o=m.exports.useMemo(()=>{function a(l,c){typeof l=="string"?s(r=>{const u=l,p=c;r[u]=p}):typeof l=="function"?s(l):typeof l=="object"&&s(r=>{const u=l;for(const p of Object.keys(u)){const d=p;r[d]=u[d]}})}return a},[s]);return[t,o]}function qt(n,t=0){if(n.length<2)throw new Error("List requires at least two elements");const[s,o]=m.exports.useState(t);function a(){o((s+1)%n.length)}return{current:m.exports.useMemo(()=>n[s],[n,s]),next:a}}function De(n=!1){const[t,s]=m.exports.useState(n);function o(){s(!1)}function a(){s(!0)}return{visible:t,hide:o,show:a}}function Ye(n){const{className:t,checked:s=!1,onChange:o=H}=n,a=v("checkbox",{checked:s},t);function l(){o(!s)}return e.createElement("div",{className:a,onClick:l},e.createElement(R,{className:"checkbox-icon",type:"check",size:18}),e.createElement("div",null,n.children))}function ae(n){const{color:t,className:s,style:o}=n,a=v("tag",s),l={color:t,...o},c={...n,className:a,style:l};return e.createElement("span",{...c},n.children)}function Kt(n){const t=v("spinner",n.className);return e.createElement("div",{className:t},e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})))}function Qe(n){const t=v("loading","visible",n.className);return n.visible?e.createElement("div",{className:t},e.createElement(Kt,{className:n.spinnerClassName})):null}function Yt(n){var a,l,c;const t=m.exports.useRef(document.createElement("div"));m.exports.useLayoutEffect(()=>{const r=t.current;return document.body.appendChild(r),()=>{document.body.removeChild(r)}},[]);const s="absolute h-full right-0 transition-transform transform translate-x-full duration-100 pointer-events-auto",o=e.createElement("div",{className:v(n.className,"z-9999 pointer-events-none absolute inset-0")},e.createElement(U,{className:v(s,n.bodyClassName,{"translate-x-0":n.visible}),style:{width:(a=n.width)!=null?a:400}},n.children));return Se.exports.createPortal(o,(c=(l=n.containerRef)==null?void 0:l.current)!=null?c:t.current)}se.extend(at);function Fe(n,t){const s=t==="en_US"?"en":"zh-cn";return se(n).locale(s).from(se())}function Qt(n){const{translation:t}=F(),s=m.exports.useMemo(()=>t("Connections").t,[t]),{className:o,style:a}=n,l=v("flex flex-wrap px-1",o);function c(r){var u;(u=n.onChange)==null||u.call(n,r)}return e.createElement("div",{className:l,style:a},e.createElement("div",{className:v("connections-devices-item mb-2 pt-2",{selected:n.selected===""}),onClick:()=>c("")},s("filter.all")),n.devices.map(r=>e.createElement("div",{key:r.label,className:v("connections-devices-item mb-2 pt-2",{selected:n.selected===r.label}),onClick:()=>c(r.label)},r.label," (",r.number,")")))}function Zt(n){var o,a,l,c,r,u,p,d,E,y,h,f,x;const{translation:t}=F(),s=m.exports.useMemo(()=>t("Connections").t,[t]);return e.createElement("div",{className:v(n.className,"flex flex-col overflow-y-auto text-sm")},e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.id")),e.createElement("span",{className:"font-mono"},n.connection.id)),e.createElement("div",{className:"my-3 flex justify-between"},e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"w-20 font-bold"},s("info.network")),e.createElement("span",{className:"font-mono"},(o=n.connection.metadata)==null?void 0:o.network)),e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"w-20 font-bold"},s("info.inbound")),e.createElement("span",{className:"font-mono"},(a=n.connection.metadata)==null?void 0:a.type))),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.host")),e.createElement("span",{className:"flex-1 break-all font-mono"},(l=n.connection.metadata)!=null&&l.host?`${n.connection.metadata.host}:${(c=n.connection.metadata)==null?void 0:c.destinationPort}`:s("info.hostEmpty"))),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.dstIP")),e.createElement("span",{className:"font-mono"},(r=n.connection.metadata)!=null&&r.destinationIP?`${n.connection.metadata.destinationIP}:${(u=n.connection.metadata)==null?void 0:u.destinationPort}`:s("info.hostEmpty"))),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.srcIP")),e.createElement("span",{className:"font-mono"},`${(p=n.connection.metadata)==null?void 0:p.sourceIP}:${(d=n.connection.metadata)==null?void 0:d.sourcePort}`)),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.process")),e.createElement("span",{className:"flex-1 break-all font-mono"},(E=n.connection.metadata)!=null&&E.processPath?`${ze(n.connection.metadata.processPath)}`:s("info.hostEmpty"))),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.processPath")),e.createElement("span",{className:"flex-1 break-all font-mono"},(y=n.connection.metadata)!=null&&y.processPath?`${n.connection.metadata.processPath}`:s("info.hostEmpty"))),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.rule")),e.createElement("span",{className:"font-mono"},n.connection.rule&&`${n.connection.rule}${n.connection.rulePayload&&` :: ${n.connection.rulePayload}`}`)),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.chains")),e.createElement("span",{className:"flex-1 break-all font-mono"},(h=n.connection.chains)==null?void 0:h.slice().reverse().join(" / "))),e.createElement("div",{className:"my-3 flex justify-between"},e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"w-20 font-bold"},s("info.upload")),e.createElement("span",{className:"font-mono"},z((f=n.connection.upload)!=null?f:0))),e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"w-20 font-bold"},s("info.download")),e.createElement("span",{className:"font-mono"},z((x=n.connection.download)!=null?x:0)))),e.createElement("div",{className:"my-3 flex"},e.createElement("span",{className:"w-20 font-bold"},s("info.status")),e.createElement("span",{className:"font-mono"},n.connection.completed?e.createElement("span",{className:"text-red"},s("info.closed")):e.createElement("span",{className:"text-green"},s("info.opening")))))}class en{constructor(){this.connections=new Map,this.saveDisconnection=!1}appendToSet(t){var o;const s=t.reduce((a,l)=>a.set(l.id,l),new Map);for(const a of this.connections.keys())if(!s.has(a))if(!this.saveDisconnection)this.connections.delete(a);else{const l=this.connections.get(a);l!=null&&this.connections.set(a,we(l,c=>{c.completed=!0,c.uploadSpeed=0,c.downloadSpeed=0}))}for(const a of s.keys()){if(!this.connections.has(a)){this.connections.set(a,{...s.get(a),uploadSpeed:0,downloadSpeed:0});continue}const l=this.connections.get(a),c=s.get(a);(o=this.connections)==null||o.set(a,{...c,uploadSpeed:c.upload-l.upload,downloadSpeed:c.download-l.download})}}toggleSave(){var t,s;if(this.saveDisconnection){this.saveDisconnection=!1;for(const o of this.connections.keys())(s=(t=this.connections)==null?void 0:t.get(o))!=null&&s.completed&&this.connections.delete(o)}else this.saveDisconnection=!0;return this.saveDisconnection}getConnections(){return[...this.connections.values()]}}function tn(){const n=m.exports.useMemo(()=>new en,[]),t=m.exports.useRef(!0),[s,o]=m.exports.useState([]),[a,l]=m.exports.useState(!1),c=m.exports.useCallback(function(u){n.appendToSet(u),t.current&&o(n.getConnections()),t.current=!t.current},[n]),r=m.exports.useCallback(function(){const u=n.toggleSave();l(u),u||o(n.getConnections()),t.current=!0},[n]);return{connections:s,feed:c,toggleSave:r,save:a}}const w={Host:"host",Network:"network",Process:"process",Type:"type",Chains:"chains",Rule:"rule",Speed:"speed",Upload:"upload",Download:"download",SourceIP:"sourceIP",Time:"time"},nn=new Set([w.Network,w.Type,w.Speed,w.Upload,w.Download,w.SourceIP,w.Time,w.Process]);function sn(n,t){switch(!0){case(n===0&&t===0):return"-";case(n!==0&&t!==0):return`\u2191 ${z(n)}/s \u2193 ${z(t)}/s`;case n!==0:return`\u2191 ${z(n)}/s`;default:return`\u2193 ${z(t)}/s`}}const I=ut();function on(){const{translation:n,lang:t}=F(),s=m.exports.useMemo(()=>n("Connections").t,[n]),o=Ot(),a=he(o),l=$(),c=m.exports.useRef(null),[r,u]=oe({uploadTotal:0,downloadTotal:0}),{visible:p,show:d,hide:E}=De();function y(){l.closeAllConnections().finally(()=>E())}const{connections:h,feed:f,save:x,toggleSave:b}=tn(),N=m.exports.useMemo(()=>h.map(i=>({id:i.id,host:`${i.metadata.host||i.metadata.destinationIP}:${i.metadata.destinationPort}`,chains:i.chains.slice().reverse().join(" / "),rule:i.rulePayload?`${i.rule} :: ${i.rulePayload}`:i.rule,time:new Date(i.start).getTime(),upload:i.upload,download:i.download,sourceIP:i.metadata.sourceIP,type:i.metadata.type,network:i.metadata.network.toUpperCase(),process:i.metadata.processPath,speed:{upload:i.uploadSpeed,download:i.downloadSpeed},completed:!!i.completed,original:i})),[h]),S=m.exports.useMemo(()=>{const i=lt(h,"metadata.sourceIP");return Object.keys(i).map(P=>({label:P,number:i[P].length})).sort((P,g)=>P.label.localeCompare(g.label))},[h]),k=m.exports.useRef(null),A=ct(k,{threshold:[1]}),q=m.exports.useMemo(()=>[I.accessor(w.Host,{minSize:260,size:260,header:s(`columns.${w.Host}`)}),I.accessor(w.Network,{minSize:80,size:80,header:s(`columns.${w.Network}`)}),I.accessor(w.Type,{minSize:100,size:100,header:s(`columns.${w.Type}`)}),I.accessor(w.Chains,{minSize:200,size:200,header:s(`columns.${w.Chains}`)}),I.accessor(w.Rule,{minSize:140,size:140,header:s(`columns.${w.Rule}`)}),I.accessor(w.Process,{minSize:100,size:100,header:s(`columns.${w.Process}`),cell:i=>i.getValue()?ze(i.getValue()):"-"}),I.accessor(i=>[i.speed.upload,i.speed.download],{id:w.Speed,header:s(`columns.${w.Speed}`),minSize:200,size:200,sortDescFirst:!0,sortingFn(i,P){var _,ee,Ae,Le;const g=(ee=(_=i.original)==null?void 0:_.speed)!=null?ee:{upload:0,download:0},M=(Le=(Ae=P.original)==null?void 0:Ae.speed)!=null?Le:{upload:0,download:0};return g.download===M.download?g.upload-M.upload:g.download-M.download},cell:i=>sn(i.getValue()[0],i.getValue()[1])}),I.accessor(w.Upload,{minSize:100,size:100,header:s(`columns.${w.Upload}`),cell:i=>z(i.getValue())}),I.accessor(w.Download,{minSize:100,size:100,header:s(`columns.${w.Download}`),cell:i=>z(i.getValue())}),I.accessor(w.SourceIP,{minSize:140,size:140,header:s(`columns.${w.SourceIP}`),filterFn:"equals"}),I.accessor(w.Time,{minSize:120,size:120,header:s(`columns.${w.Time}`),cell:i=>Fe(new Date(i.getValue()),t),sortingFn:(i,P)=>{var g,M,_,ee;return((M=(g=P.original)==null?void 0:g.time)!=null?M:0)-((ee=(_=i.original)==null?void 0:_.time)!=null?ee:0)}})],[t,s]);m.exports.useLayoutEffect(()=>{function i(P){for(const g of P)u({uploadTotal:g.uploadTotal,downloadTotal:g.downloadTotal}),f(g.connections)}return o==null||o.subscribe("data",i),()=>{o==null||o.unsubscribe("data",i)}},[o,f,u]),rt(()=>{var i;(i=a.current)==null||i.destory()});const O=it({data:N,columns:q,getCoreRowModel:mt(),getSortedRowModel:dt(),getFilteredRowModel:pt(),initialState:{sorting:[{id:w.Time,desc:!1}]},columnResizeMode:"onChange",enableColumnResizing:!0}),J=O.getHeaderGroups()[0],[j,ue]=m.exports.useState("");function me(i){ue(i),O.getColumn(w.SourceIP).setFilterValue(i||void 0)}const[B,L]=oe({visible:!1,selectedID:"",connection:{}});function de(){L(i=>{i.connection.completed=!0}),l.closeConnection(B.selectedID)}const V=he(B.connection);m.exports.useEffect(()=>{var P;const i=(P=N.find(g=>g.id===B.selectedID))==null?void 0:P.original;i?L(g=>{g.connection={...i},B.selectedID===V.current.id&&(g.connection.completed=V.current.completed)}):Object.keys(V.current).length!==0&&!V.current.completed&&L(g=>{g.connection.completed=!0})},[N,B.selectedID,V,L]);const Z=m.exports.useMemo(()=>{var i;return((i=A==null?void 0:A.intersectionRatio)!=null?i:0)<1},[A]),ne=J.headers.map((i,P)=>{const g=i.column,M=g.id;return e.createElement("th",{className:v("connections-th",{resizing:g.getIsResizing(),fixed:g.id===w.Host,shadow:Z&&g.id===w.Host}),style:{width:i.getSize()},ref:g.id===w.Host?k:void 0,key:M},e.createElement("div",{onClick:g.getToggleSortingHandler()},$e(i.column.columnDef.header,i.getContext()),g.getIsSorted()!==!1?g.getIsSorted()==="desc"?" \u2193":" \u2191":null),P!==J.headers.length-1&&e.createElement("div",{onMouseDown:i.getResizeHandler(),onTouchStart:i.getResizeHandler(),className:"connections-resizer"}))}),C=O.getRowModel().rows.map(i=>{var P;return e.createElement("tr",{className:"cursor-default select-none",key:(P=i.original)==null?void 0:P.id,onClick:()=>{var g;return L({visible:!0,selectedID:(g=i.original)==null?void 0:g.id})}},i.getAllCells().map(g=>{var _;const M=v("connections-block",{"text-center":nn.has(g.column.id),completed:(_=i.original)==null?void 0:_.completed},{fixed:g.column.id===w.Host,shadow:Z&&g.column.id===w.Host});return e.createElement("td",{className:M,style:{width:g.column.getSize()},key:g.column.id},$e(g.column.columnDef.cell,g.getContext()))}))});return e.createElement("div",{className:"page !h-100vh"},e.createElement(G,{title:s("title")},e.createElement("span",{className:"connections-filter flex-1 cursor-default"},`(${s("total.text")}: ${s("total.upload")} ${z(r.uploadTotal)} ${s("total.download")} ${z(r.downloadTotal)})`),e.createElement(Ye,{className:"connections-filter",checked:x,onChange:b},s("keepClosed")),e.createElement(R,{className:"connections-filter dangerous",onClick:d,type:"close-all",size:20})),S.length>1&&e.createElement(Qt,{devices:S,selected:j,onChange:me}),e.createElement(U,{ref:c,className:"connections-card relative"},e.createElement("div",{className:"min-h-full min-w-full overflow-auto"},e.createElement("table",null,e.createElement("thead",null,e.createElement("tr",{className:"connections-header"},ne)),e.createElement("tbody",null,C)))),e.createElement(Ke,{title:s("closeAll.title"),show:p,onClose:E,onOk:y},s("closeAll.content")),e.createElement(Yt,{containerRef:c,bodyClassName:"flex flex-col",visible:B.visible,width:450},e.createElement("div",{className:"flex h-8 items-center justify-between"},e.createElement("span",{className:"pl-3 font-bold"},s("info.title")),e.createElement(R,{type:"close",size:16,className:"cursor-pointer",onClick:()=>L("visible",!1)})),e.createElement(Zt,{className:"mt-3 px-5",connection:B.connection}),e.createElement("div",{className:"mt-3 flex justify-end pr-3"},e.createElement(ye,{type:"danger",disiabled:B.connection.completed,onClick:()=>de()},s("info.closeConnection")))))}function an(){const{translation:n}=F(),{t}=n("Settings"),{hostname:s,port:o,secret:a}=te(),[l,c]=T(ke),[r,u]=oe({hostname:"",port:"",secret:""});m.exports.useEffect(()=>{u({hostname:s,port:o,secret:a})},[s,o,a,u]);const p=Pe(Oe);function d(){const{hostname:E,port:y,secret:h}=r;p([{hostname:E,port:y,secret:h}])}return e.createElement(Ke,{show:!l,title:t("externalControllerSetting.title"),bodyClassName:"external-controller",onClose:()=>c(!0),onOk:d},e.createElement(Xt,{type:"info",inside:!0},e.createElement("p",null,t("externalControllerSetting.note"))),e.createElement("div",{className:"flex items-center"},e.createElement("span",{className:"my-1 w-14 font-bold md:my-3"},t("externalControllerSetting.host")),e.createElement(Y,{className:"my-1 flex-1 md:my-3",align:"left",inside:!0,value:r.hostname,onChange:E=>u("hostname",E),onEnter:d})),e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"my-1 w-14 font-bold md:my-3"},t("externalControllerSetting.port")),e.createElement(Y,{className:"my-1 w-14 flex-1 md:my-3",align:"left",inside:!0,value:r.port,onChange:E=>u("port",E),onEnter:d})),e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"my-1 w-14 font-bold md:my-3"},t("externalControllerSetting.secret")),e.createElement(Y,{className:"my-1 w-14 flex-1 md:my-3",align:"left",inside:!0,value:r.secret,onChange:E=>u("secret",E),onEnter:d})))}const ln=[{label:"Default",value:""},{label:"Debug",value:"debug"},{label:"Info",value:"info"},{label:"Warn",value:"warning"},{label:"Error",value:"error"},{label:"Silent",value:"silent"}],cn=new Map([["debug","text-teal-500"],["info","text-sky-500"],["warning","text-pink-500"],["error","text-rose-500"]]);function rn(){var y,h;const n=m.exports.useRef(null),t=m.exports.useRef([]),[s,o]=m.exports.useState([]),{translation:a}=F(),{data:{logLevel:l},set:c}=ce(),{general:{logLevel:r}}=re(),{t:u}=a("Logs"),p=qe(),d=m.exports.useRef((h=(y=n.current)==null?void 0:y.scrollHeight)!=null?h:0),E=ft(r)==="silent";return m.exports.useLayoutEffect(()=>{var x;const f=n.current;f!=null&&d.current===f.scrollTop+f.clientHeight&&(f.scrollTop=f.scrollHeight-f.clientHeight),d.current=(x=f==null?void 0:f.scrollHeight)!=null?x:0}),m.exports.useEffect(()=>{function f(x){t.current=t.current.slice().concat(x.map(b=>({...b,time:new Date}))),o(t.current)}return p!=null&&(p.subscribe("data",f),t.current=p.buffer(),o(t.current)),()=>p==null?void 0:p.unsubscribe("data",f)},[p]),e.createElement("div",{className:"page"},e.createElement(G,{title:u("title")},e.createElement("span",{className:"text-primary-darken mr-2 text-sm"},u("levelLabel"),":"),e.createElement(Wt,{disabled:E,options:ln,value:E?"silent":l,onSelect:f=>c(x=>{x.logLevel=f})})),e.createElement(U,{className:"mt-2.5 flex flex-1 flex-col md:mt-4"},e.createElement("ul",{className:"logs-panel",ref:n},s.map((f,x)=>e.createElement("li",{className:"inline-block text-[11px] leading-5",key:x},e.createElement("span",{className:"mr-2 text-orange-400"},"[",se(f.time).format("YYYY-MM-DD HH:mm:ss"),"]"),e.createElement("span",{className:cn.get(f.type)},"[",f.type.toUpperCase(),"]"),e.createElement("span",null," ",f.payload))))))}var xe=(n=>(n.SPEED_NOTIFY="speed-notify",n))(xe||{});class un{constructor(){this.EE=new Be}notifySpeedTest(){this.EE.emit("speed-notify")}subscribe(t,s){this.EE.addListener(t,s)}unsubscribe(t,s){this.EE.removeListener(t,s)}}const ge=new un;const Re={"#909399":0,"#00c520":260,"#ff9a28":600,"#ff3e5e":1/0};function Ze(n){var h,f;const{config:t,className:s}=n,{set:o}=ie(),a=$(),l=m.exports.useCallback(async x=>{var N;if(Q())return(N=await(D==null?void 0:D.getProxyDelay(x)))!=null?N:0;const{data:{delay:b}}=await a.getProxyDelay(x);return b},[a]),c=m.exports.useCallback(async function(){const x=await Me.fromPromise(l(t.name),N=>N),b=x.isErr()?0:x.value;o(N=>{const S=N.proxies.find(k=>k.name===t.name);S!=null&&S.history.push({time:Date.now().toString(),delay:b})})},[t.name,l,o]),r=m.exports.useMemo(()=>{var x;return(x=t.history)!=null&&x.length?t.history.slice(-1)[0].delay:0},[t]);m.exports.useLayoutEffect(()=>{const x=()=>{c()};return ge.subscribe(xe.SPEED_NOTIFY,x),()=>ge.unsubscribe(xe.SPEED_NOTIFY,x)},[c]);const u=m.exports.useMemo(()=>r===0,[r]),p=m.exports.useMemo(()=>Object.keys(Re).find(x=>r<=Re[x]),[r]),d=u?"#E5E7EB":p;function E(){if(n.config.secretData==null){K.error("No data",{duration:500});return}navigator.clipboard.writeText(n.config.secretData).catch(()=>K("err",{duration:500})).then(()=>K("ok",{duration:500}))}const y=(f=(h=n.config)==null?void 0:h.all)!=null?f:[];return e.createElement("div",{className:v("proxy-item",{"opacity-50":u},s)},e.createElement("div",{className:"flex-1 "},e.createElement("div",{className:"flex items-center display:flex"},e.createElement("span",{className:v("rounded-sm py-[3px] px-1 text-[10px] text-white",{"text-gray-600":u}),style:{backgroundColor:d}},t.type),e.createElement("div",{className:"proxy-info-copy flex flex-auto items-center justify-end"},e.createElement("p",{className:"rounded-sm py-[3px] px-1 text-[10px]",style:{backgroundColor:"#E5E7EB"},onClick:E},"info"))),e.createElement("p",{className:"proxy-name"},t.name),y.map((x,b)=>e.createElement("div",{className:"relay-node"},"- ",x))),e.createElement("div",{className:"flex h-full flex-col items-center justify-center space-y-3 text-[10px] md:h-[18px] md:flex-row md:justify-between md:space-y-0"},e.createElement("p",null,r===0?"-":`${r}ms`),t.udp&&e.createElement("p",{className:"rounded bg-gray-200 p-[3px] text-gray-600"},"UDP")))}function mn(n){const{markProxySelected:t}=ie(),[s]=T(Mt),{data:o}=ce(),a=$(),{config:l}=n;async function c(p){if(await a.changeProxySelected(n.config.name,p),t(n.config.name,p),o.breakConnections){const d=[],E=await a.getConnections();for(const y of E.data.connections)y.chains.includes(n.config.name)&&d.push(y.id);await Promise.all(d.map(y=>a.closeConnection(y)))}}const r=m.exports.useMemo(()=>{var d;const p=new Set;for(const E of l.all){const y=(d=s.get(E))==null?void 0:d.history;(y==null?void 0:y.length)&&y.slice(-1)[0].delay===0&&p.add(E)}return p},[l.all,s]),u=l.type==="Selector";return e.createElement("div",{className:"proxy-group"},e.createElement("div",{className:"md:h-15 mt-4 flex h-10 w-full items-center justify-between md:mt-0 md:w-auto"},e.createElement("span",{className:"w-35 md:w-30 h-6 overflow-hidden overflow-ellipsis whitespace-nowrap px-5"},l.name),e.createElement(ae,{className:"mr-5 md:mr-0"},l.type)),e.createElement("div",{className:"flex-1 py-2 md:py-4"},e.createElement(_t,{className:"ml-5 md:ml-8",data:l.all,onClick:c,errSet:r,select:l.now,canClick:u,rowHeight:30})))}function dn(n){const{update:t}=Ge(),{translation:s,lang:o}=F(),a=$(),{provider:l}=n,{t:c}=s("Proxies"),{visible:r,hide:u,show:p}=De();function d(){p(),a.healthCheckProvider(l.name).then(async()=>await t()).finally(()=>u())}function E(){p(),a.updateProvider(l.name).then(async()=>await t()).finally(()=>u())}const y=m.exports.useMemo(()=>l.proxies.slice().sort((h,f)=>-1*ve(h,f)),[l.proxies]);return e.createElement(U,{className:"proxy-provider"},e.createElement(Qe,{visible:r}),e.createElement("div",{className:"md:flex-row md:items-center flex flex-col justify-between"},e.createElement("div",{className:"flex items-center"},e.createElement("span",{className:"mr-6"},l.name),e.createElement(ae,null,l.vehicleType)),e.createElement("div",{className:"flex items-center pt-3 md:pt-0"},l.updatedAt&&e.createElement("span",{className:"text-sm"},`${c("providerUpdateTime")}: ${Fe(new Date(l.updatedAt),o)}`),e.createElement(R,{className:"text-red cursor-pointer pl-5",type:"healthcheck",size:18,onClick:d}),e.createElement(R,{className:"cursor-pointer pl-5",type:"update",size:18,onClick:E}))),e.createElement("ul",{className:"proxies-list"},y.map(h=>e.createElement("li",{key:h.name},e.createElement(Ze,{className:"proxy-provider-item",config:h})))))}const pn={[0]:"sort",[1]:"sort-ascending",[2]:"sort-descending"};function ve(n,t){const s=n.history.length>0?n.history.slice(-1)[0].delay:0;return((t.history.length>0?t.history.slice(-1)[0].delay:0)||Number.MAX_SAFE_INTEGER)-(s||Number.MAX_SAFE_INTEGER)}function fn(){const{groups:n,global:t}=ie(),{data:s,set:o}=ce(),{general:a}=re(),{translation:l}=F(),{t:c}=l("Proxies"),r=m.exports.useMemo(()=>a.mode==="global"?[t,...n]:n,[a,n,t]);return e.createElement(e.Fragment,null,r.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(G,{title:c("groupTitle")},e.createElement(Ye,{className:"text-shadow-primary text-primary-600 cursor-pointer text-sm",checked:s.breakConnections,onChange:u=>o("breakConnections",u)},c("breakConnectionsText"))),e.createElement(U,{className:"my-2.5 p-0 md:my-4"},e.createElement("ul",{className:"list-none divide-y divide-gray-300"},r.map(u=>e.createElement("li",{key:u.name},e.createElement(mn,{config:u})))))))}function En(){const{providers:n}=Ge(),{translation:t}=F(),{t:s}=t("Proxies");return e.createElement(e.Fragment,null,n.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(G,{title:s("providerTitle")}),e.createElement("ul",{className:"list-none"},n.map(o=>e.createElement("li",{className:"my-2.5 md:my-4",key:o.name},e.createElement(dn,{provider:o}))))))}function hn(){const{proxies:n}=ie(),{translation:t}=F(),{t:s}=t("Proxies");function o(){ge.notifySpeedTest()}const{current:a,next:l}=qt([1,2,0]),c=m.exports.useMemo(()=>{switch(a){case 2:return n.slice().sort((u,p)=>ve(u,p));case 1:return n.slice().sort((u,p)=>-1*ve(u,p));default:return n.slice()}},[a,n]),r=l;return e.createElement(e.Fragment,null,c.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(G,{title:s("title")},e.createElement(R,{className:"ml-3",type:pn[a],onClick:r,size:20}),e.createElement(R,{className:"ml-3",type:"speed",size:20}),e.createElement("span",{className:"proxies-speed-test",onClick:o},s("speedTestText"))),e.createElement("ul",{className:"proxies-list"},c.map(u=>e.createElement("li",{key:u.name},e.createElement(Ze,{config:u}))))))}function yn(){return e.createElement("div",{className:"page"},e.createElement(fn,null),e.createElement(En,null),e.createElement(hn,null))}function xn(n){const{update:t}=_e(),{translation:s,lang:o}=F(),a=$(),{provider:l}=n,{t:c}=s("Rules"),{visible:r,hide:u,show:p}=De();function d(){p(),a.updateRuleProvider(l.name).then(async()=>await t()).finally(()=>u())}const E=v("rule-provider-icon",{"rule-provider-loading":r});return e.createElement("div",{className:"rule-provider"},e.createElement("div",{className:"rule-provider-header"},e.createElement("div",{className:"rule-provider-header-part"},e.createElement("span",{className:"rule-provider-name"},l.name),e.createElement(ae,null,l.vehicleType),e.createElement(ae,{className:"rule-provider-behavior"},l.behavior),e.createElement("span",{className:"rule-provider-update"},`${c("ruleCount")}: ${l.ruleCount}`)),e.createElement("div",{className:"rule-provider-header-part"},l.updatedAt&&e.createElement("span",{className:"rule-provider-update"},`${c("providerUpdateTime")}: ${Fe(new Date(l.updatedAt),o)}`),e.createElement(R,{className:E,type:"update",size:18,onClick:d}))))}function gn(){const{providers:n}=_e(),{translation:t}=F(),{t:s}=t("Rules");return e.createElement(e.Fragment,null,n.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(G,{title:s("providerTitle")}),e.createElement(U,{className:"shadow-primary mt-4 divide-y rounded p-0"},n.map(o=>e.createElement(xn,{key:o.name,provider:o})))))}function vn(){const{rules:n,update:t}=Ht(),{translation:s}=F(),{t:o}=s("Rules");W("rules",t);function a({index:l,style:c}){const r=n[l];return e.createElement("li",{className:"rule-item",style:c},e.createElement("div",{className:"flex py-1"},e.createElement("div",{className:"rule-type w-40 text-center"},r.type),e.createElement("div",{className:"payload flex-1 text-center"},r.payload),e.createElement("div",{className:"rule-proxy w-40 text-center"},r.proxy)))}return e.createElement("div",{className:"page"},e.createElement(gn,null),e.createElement(G,{className:"not-first:mt-7.5",title:o("title")}),e.createElement(U,{className:"mt-2.5 flex flex-1 flex-col p-0 focus:outline-none md:mt-4"},e.createElement(Et,{className:"min-h-120"},({height:l,width:c})=>e.createElement(ht,{height:l,width:c,itemCount:n.length,itemSize:50},a))))}const wn=[{label:"\u4E2D\u6587",value:"zh_CN"},{label:"English",value:"en_US"}];function bn(){var V,Z,ne;const{premium:n}=Ve(),{data:t,update:s}=Xe(),{general:o,update:a}=re(),l=Pe(ke),c=te(),{translation:r,setLang:u,lang:p}=F(),{t:d}=r("Settings"),E=$(),[y,h]=oe({socks5ProxyPort:7891,httpProxyPort:7890,mixedProxyPort:0});m.exports.useEffect(()=>{var C,i,P;h("socks5ProxyPort",(C=o==null?void 0:o.socksPort)!=null?C:0),h("httpProxyPort",(i=o==null?void 0:o.port)!=null?i:0),h("mixedProxyPort",(P=o==null?void 0:o.mixedPort)!=null?P:0)},[o,h]);async function f(C){await E.updateConfig({mode:C}),await a()}async function x(C){await(D==null?void 0:D.setStartAtLogin(C)),await s()}async function b(C){await(D==null?void 0:D.setSystemProxy(C)),await s()}function N(C){u(C)}async function S(){await E.updateConfig({port:y.httpProxyPort}),await a()}async function k(){await E.updateConfig({"socks-port":y.socks5ProxyPort}),await a()}async function A(){await E.updateConfig({"mixed-port":y.mixedProxyPort}),await a()}async function q(C){await E.updateConfig({"allow-lan":C}),await a()}const{hostname:O,port:J}=c,{allowLan:j,mode:ue}=o,me=(V=t==null?void 0:t.startAtLogin)!=null?V:!1,B=(Z=t==null?void 0:t.systemProxy)!=null?Z:!1,L=(ne=t==null?void 0:t.isClashX)!=null?ne:!1,de=m.exports.useMemo(()=>{const C=[{label:d("values.global"),value:"Global"},{label:d("values.rules"),value:"Rule"},{label:d("values.direct"),value:"Direct"}];return n&&C.push({label:d("values.script"),value:"Script"}),C},[d,n]);return e.createElement("div",{className:"page"},e.createElement(G,{title:d("title")}),e.createElement(U,{className:"settings-card"},e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2"},e.createElement("span",{className:"label font-bold"},d("labels.startAtLogin")),e.createElement(fe,{disabled:!(t!=null&&t.isClashX),checked:me,onChange:x})),e.createElement("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2"},e.createElement("span",{className:"label font-bold"},d("labels.language")),e.createElement(Ie,{options:wn,value:p,onSelect:C=>N(C)}))),e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2"},e.createElement("span",{className:"label font-bold"},d("labels.setAsSystemProxy")),e.createElement(fe,{disabled:!L,checked:B,onChange:b})),e.createElement("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2"},e.createElement("span",{className:"label font-bold"},d("labels.allowConnectFromLan")),e.createElement(fe,{checked:j,onChange:q})))),e.createElement(U,{className:"settings-card"},e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2"},e.createElement("span",{className:"label font-bold"},d("labels.proxyMode")),e.createElement(Ie,{options:de,value:yt(ue),onSelect:f})),e.createElement("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2"},e.createElement("span",{className:"label font-bold"},d("labels.socks5ProxyPort")),e.createElement(Y,{className:"w-28",disabled:L,value:y.socks5ProxyPort,onChange:C=>h("socks5ProxyPort",+C),onBlur:k}))),e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2"},e.createElement("span",{className:"label font-bold"},d("labels.httpProxyPort")),e.createElement(Y,{className:"w-28",disabled:L,value:y.httpProxyPort,onChange:C=>h("httpProxyPort",+C),onBlur:S})),e.createElement("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2"},e.createElement("span",{className:"label font-bold"},d("labels.mixedProxyPort")),e.createElement(Y,{className:"w-28",disabled:L,value:y.mixedProxyPort,onChange:C=>h("mixedProxyPort",+C),onBlur:A}))),e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2"},e.createElement("span",{className:"label font-bold"},d("labels.externalController")),e.createElement("span",{className:v({"modify-btn":!L},"external-controller"),onClick:()=>!L&&l(!1)},`${O}:${J}`)),e.createElement("div",{className:"w-1/2 px-8"}))))}const Cn=""+new URL("logo.b453e72f.png",import.meta.url).href;function Nn(n){const{routes:t}=n,{translation:s}=F(),{version:o,premium:a}=Ve(),{data:l}=Xe(),{t:c}=s("SideBar"),r=Ce(),u=t.map(({path:p,name:d,noMobile:E})=>e.createElement("li",{className:v("item",{"no-mobile":E}),key:d},e.createElement(xt,{to:{pathname:p,search:r.search},className:({isActive:y})=>v({active:y})},c(d))));return e.createElement("div",{className:"sidebar"},e.createElement("img",{src:Cn,alt:"logo",className:"sidebar-logo"}),e.createElement("ul",{className:"sidebar-menu"},u),e.createElement("div",{className:"sidebar-version"},e.createElement("span",{className:"sidebar-version-label"},"Clash",(l==null?void 0:l.isClashX)&&"X"," ",c("Version")),e.createElement("span",{className:"sidebar-version-text"},o),a&&e.createElement("span",{className:"sidebar-version-label"},"Premium")))}function Pn(n){const{config:t,className:s}=n,o="#00C520";function a(){if(n.config.secretData==null){K.error("No data",{duration:500});return}navigator.clipboard.writeText(n.config.secretData).catch(()=>K("err",{duration:500})).then(()=>K("ok",{duration:500}))}return e.createElement("div",{className:v("inbound-item",t.type)},e.createElement("div",{className:"flex-1 "},e.createElement("div",{className:"flex items-center display:flex"},e.createElement("span",{className:v("rounded-sm py-[3px] px-1 text-[10px] text-white"),style:{backgroundColor:o}},t.type),e.createElement("div",{className:"proxy-info-copy flex flex-auto items-center justify-end"},e.createElement("p",{className:"rounded-sm py-[3px] px-1 text-[10px]",style:{backgroundColor:"#E5E7EB"},onClick:a},"info"))),e.createElement("p",{className:"inbound-name"},t.name),e.createElement("p",{className:"inbound-addr"},t.rawAddress)))}function Sn(){const{inbounds:n,update:t}=Vt();return W("inbounds",t),console.log(n),e.createElement("div",{className:"page"},n.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement("ul",{className:"inbounds-list"},n.map(s=>e.createElement("li",null,e.createElement(Pn,{config:s}))))))}function kn(){qe();const n=Ce(),t=[{path:"/proxies",name:"Proxies",element:e.createElement(yn,null)},{path:"/inbounds",name:"Inbounds",element:e.createElement(Sn,null)},{path:"/logs",name:"Logs",element:e.createElement(rn,null)},{path:"/rules",name:"Rules",element:e.createElement(vn,null),noMobile:!0},{path:"/connections",name:"Connections",element:e.createElement(on,null),noMobile:!0},{path:"/settings",name:"Settings",element:e.createElement(bn,null)}],s=e.createElement("div",{className:v("app",{"not-clashx":!Q()})},e.createElement(gt,null),e.createElement(Nn,{routes:t}),e.createElement("div",{className:"page-container"},e.createElement(vt,null)),e.createElement(an,null));return e.createElement(wt,null,e.createElement(pe,{path:"/",element:s},e.createElement(pe,{path:"/",element:e.createElement(bt,{to:{pathname:"/proxies",search:n.search},replace:!0})}),t.map(o=>e.createElement(pe,{path:o.path,key:o.path,element:o.element}))))}function Te(){const n=document.getElementById("root"),t=e.createElement(m.exports.StrictMode,null,e.createElement(Nt,null,e.createElement(m.exports.Suspense,{fallback:e.createElement(Qe,{visible:!0})},e.createElement(kn,null))));Ct(n).render(t)}Q()?St(()=>Te()):Te();
